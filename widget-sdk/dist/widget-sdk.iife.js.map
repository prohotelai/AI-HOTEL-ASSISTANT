{"version":3,"file":"widget-sdk.iife.js","sources":["../src/utils.ts","../src/chatClient.ts","../src/events.ts","../src/i18n.ts","../src/voice.ts","../src/style.ts","../src/theme.ts","../src/widgetDom.ts","../src/index.ts"],"sourcesContent":["import { WidgetLanguage, WidgetMessage } from './types'\n\nexport function resolveElement(target?: HTMLElement | string): HTMLElement {\n  if (!target) {\n    const el = document.createElement('div')\n    document.body.appendChild(el)\n    return el\n  }\n\n  if (target instanceof HTMLElement) {\n    return target\n  }\n\n  const found = document.querySelector<HTMLElement>(target)\n  if (!found) {\n    const el = document.createElement('div')\n    document.body.appendChild(el)\n    return el\n  }\n  return found\n}\n\nexport function buildEndpointUrl(base: string, path: string) {\n  const normalizedBase = base.endsWith('/') ? base.slice(0, -1) : base\n  const normalizedPath = path.startsWith('/') ? path : `/${path}`\n  return `${normalizedBase}${normalizedPath}`\n}\n\nexport function randomId(prefix = 'msg') {\n  if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') {\n    return crypto.randomUUID()\n  }\n  return `${prefix}-${Math.random().toString(36).slice(2, 11)}`\n}\n\nexport function toMessage(value: { id: string; role: 'user' | 'assistant'; content: string; createdAt: string }): WidgetMessage {\n  return {\n    id: value.id,\n    role: value.role,\n    content: value.content,\n    createdAt: new Date(value.createdAt),\n  }\n}\n\nexport function normalizeLanguage(language: string | undefined, fallback: WidgetLanguage): WidgetLanguage {\n  if (!language) return fallback\n  const normalized = language.toLowerCase()\n  if (normalized === 'en' || normalized === 'es' || normalized === 'fr') {\n    return normalized\n  }\n  return fallback\n}\n","import { WidgetMessage } from './types'\nimport { buildEndpointUrl, toMessage } from './utils'\n\ntype ChatClientConfig = {\n  apiBaseUrl: string\n  hotelId: string\n  conversationId?: string\n  guestId?: string\n  headers?: Record<string, string>\n  permissions?: string[]\n}\n\ntype ChatResponse = {\n  conversationId: string\n  messages: Array<{\n    id: string\n    role: 'user' | 'assistant'\n    content: string\n    createdAt: string\n  }>\n}\n\nexport function createChatClient(config: ChatClientConfig) {\n  async function sendMessage(content: string): Promise<{ messages: WidgetMessage[]; conversationId: string }> {\n    const endpoint = buildEndpointUrl(config.apiBaseUrl, '/api/chat')\n\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...config.headers,\n      },\n      body: JSON.stringify({\n        hotelId: config.hotelId,\n        conversationId: config.conversationId,\n        guestId: config.guestId,\n        message: content,\n        permissions: config.permissions,\n      }),\n    })\n\n    if (!response.ok) {\n      const body = await response.text()\n      throw new Error(`Chat request failed: ${response.status} ${body}`)\n    }\n\n    const data = (await response.json()) as ChatResponse\n    config.conversationId = data.conversationId\n    const messages = data.messages.map(toMessage)\n    return { messages, conversationId: data.conversationId }\n  }\n\n  return { sendMessage }\n}\n","import { WidgetEvent, WidgetEventHandler, WidgetEventPayloads } from './types'\n\ntype HandlerMap = {\n  [K in WidgetEvent]?: Set<WidgetEventHandler<K>>\n}\n\nexport class WidgetEventBus {\n  private handlers: HandlerMap = {}\n\n  on<K extends WidgetEvent>(event: K, handler: WidgetEventHandler<K>): () => void {\n    const set = (this.handlers[event] ??= new Set()) as Set<WidgetEventHandler<K>>\n    set.add(handler)\n    return () => this.off(event, handler)\n  }\n\n  off<K extends WidgetEvent>(event: K, handler: WidgetEventHandler<K>) {\n    const set = this.handlers[event] as Set<WidgetEventHandler<K>> | undefined\n    set?.delete(handler)\n  }\n\n  emit<K extends WidgetEvent>(event: K, payload: WidgetEventPayloads[K]) {\n    const set = this.handlers[event] as Set<WidgetEventHandler<K>> | undefined\n    set?.forEach((handler) => handler(payload))\n    const globalEvent = new CustomEvent(`prohotelai:${event}`, { detail: payload })\n    window.dispatchEvent(globalEvent)\n  }\n}\n","import { WidgetLanguage, WidgetTranslations } from './types'\n\nconst DEFAULT_DICTIONARY: Record<WidgetLanguage, Record<string, string>> = {\n  en: {\n    'widget.title': 'Need help? Chat with us',\n    'widget.input.placeholder': 'Ask a question…',\n    'widget.send': 'Send',\n    'widget.voice.start': 'Start voice',\n    'widget.voice.stop': 'Stop voice',\n    'widget.aria.open': 'Open AI assistant chat',\n    'widget.aria.close': 'Close AI assistant chat',\n    'widget.status.offline': 'Assistant is unavailable. Try again later.',\n  },\n  es: {\n    'widget.title': '¿Necesitas ayuda? Chatea con nosotros',\n    'widget.input.placeholder': 'Haz una pregunta…',\n    'widget.send': 'Enviar',\n    'widget.voice.start': 'Iniciar voz',\n    'widget.voice.stop': 'Detener voz',\n    'widget.aria.open': 'Abrir chat del asistente de IA',\n    'widget.aria.close': 'Cerrar chat del asistente de IA',\n    'widget.status.offline': 'El asistente no está disponible. Inténtalo más tarde.',\n  },\n  fr: {\n    'widget.title': 'Besoin d’aide ? Discutez avec nous',\n    'widget.input.placeholder': 'Posez une question…',\n    'widget.send': 'Envoyer',\n    'widget.voice.start': 'Activer la voix',\n    'widget.voice.stop': 'Arrêter la voix',\n    'widget.aria.open': 'Ouvrir le chat de l’assistant IA',\n    'widget.aria.close': 'Fermer le chat de l’assistant IA',\n    'widget.status.offline': 'Assistant indisponible. Réessayez plus tard.',\n  },\n}\n\nexport function createTranslator(language: WidgetLanguage, overrides?: WidgetTranslations) {\n  let currentLanguage = language\n  const dictionaries: Record<WidgetLanguage, Record<string, string>> = {\n    en: { ...DEFAULT_DICTIONARY.en },\n    es: { ...DEFAULT_DICTIONARY.es },\n    fr: { ...DEFAULT_DICTIONARY.fr },\n  }\n\n  if (overrides) {\n    Object.entries(overrides).forEach(([lang, values]) => {\n      if (!values) return\n      const normalized = lang as WidgetLanguage\n      const existing = dictionaries[normalized] ?? {}\n      dictionaries[normalized] = { ...existing, ...values }\n    })\n  }\n\n  function t(key: string) {\n    const dict = dictionaries[currentLanguage]\n    return dict?.[key] ?? DEFAULT_DICTIONARY.en[key] ?? key\n  }\n\n  function setLanguage(lang: WidgetLanguage) {\n    currentLanguage = lang\n  }\n\n  return { t, setLanguage }\n}\n","import { WidgetEventBus } from './events'\n\ntype VoiceControllerOptions = {\n  eventBus: WidgetEventBus\n  onText: (text: string) => void\n}\n\ntype SpeechRecognitionConstructor = new () => SpeechRecognition\n\ndeclare global {\n  interface Window {\n    webkitSpeechRecognition?: SpeechRecognitionConstructor\n  }\n}\n\nexport function createVoiceController(options: VoiceControllerOptions) {\n  const SpeechRecognition = (window.SpeechRecognition ?? window.webkitSpeechRecognition) as\n    | SpeechRecognitionConstructor\n    | undefined\n\n  let recognition: SpeechRecognition | null = null\n\n  function supportsRecognition() {\n    return Boolean(SpeechRecognition)\n  }\n\n  function startRecognition() {\n    if (!SpeechRecognition) {\n      options.eventBus.emit('error', { message: 'Speech recognition not supported' })\n      return\n    }\n\n    if (recognition) {\n      recognition.stop()\n    }\n\n    recognition = new SpeechRecognition()\n    recognition.lang = navigator.language || 'en-US'\n    recognition.interimResults = false\n    recognition.onresult = (event) => {\n      const transcript = event.results?.[0]?.[0]?.transcript\n      if (transcript) {\n        options.onText(transcript)\n      }\n    }\n    recognition.onerror = (event) => {\n      options.eventBus.emit('error', { message: 'Speech recognition error', error: event.error })\n    }\n\n    recognition.start()\n    options.eventBus.emit('voice:start', undefined)\n  }\n\n  function stopRecognition() {\n    recognition?.stop()\n    recognition = null\n    options.eventBus.emit('voice:stop', undefined)\n  }\n\n  function speak(text: string) {\n    if (!('speechSynthesis' in window)) {\n      return\n    }\n    const utterance = new SpeechSynthesisUtterance(text)\n    utterance.lang = navigator.language || 'en-US'\n    window.speechSynthesis.cancel()\n    window.speechSynthesis.speak(utterance)\n  }\n\n  return {\n    supportsRecognition,\n    startRecognition,\n    stopRecognition,\n    speak,\n  }\n}\n","export function injectStyles(root: ShadowRoot | Document) {\n  const existing = root.querySelector('#prohotelai-widget-styles')\n  if (existing) return\n\n  const style = document.createElement('style')\n  style.id = 'prohotelai-widget-styles'\n  style.textContent = `\n    :host, .prohotelai-widget {\n      all: initial;\n      font-family: var(--prohotelai-font-family);\n      color: var(--prohotelai-text);\n    }\n\n    .prohotelai-toggle {\n      position: fixed;\n      bottom: 24px;\n      right: 24px;\n      background: var(--prohotelai-accent);\n      color: #fff;\n      border: none;\n      border-radius: 999px;\n      padding: 12px 16px;\n      cursor: pointer;\n      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);\n      font-size: 14px;\n    }\n\n    .prohotelai-window {\n      position: fixed;\n      bottom: 90px;\n      right: 24px;\n      width: min(360px, calc(100vw - 32px));\n      max-height: 520px;\n      background: var(--prohotelai-background);\n      color: var(--prohotelai-text);\n      border-radius: var(--prohotelai-radius);\n      box-shadow: 0 24px 48px rgba(15, 23, 42, 0.35);\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n      opacity: 0;\n      pointer-events: none;\n      transform: translateY(16px);\n      transition: opacity 0.2s ease, transform 0.2s ease;\n    }\n\n    .prohotelai-window.open {\n      opacity: 1;\n      pointer-events: auto;\n      transform: translateY(0);\n    }\n\n    .prohotelai-header {\n      padding: 16px;\n      font-weight: 600;\n      font-size: 16px;\n      border-bottom: 1px solid rgba(148, 163, 184, 0.2);\n    }\n\n    .prohotelai-messages {\n      flex: 1;\n      overflow-y: auto;\n      padding: 16px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n      scroll-behavior: smooth;\n    }\n\n    .prohotelai-message {\n      padding: 12px 14px;\n      border-radius: 12px;\n      font-size: 14px;\n      line-height: 1.4;\n      white-space: pre-wrap;\n      background: rgba(15, 23, 42, 0.45);\n    }\n\n    .prohotelai-message.user {\n      align-self: flex-end;\n      background: rgba(37, 99, 235, 0.9);\n      color: #fff;\n    }\n\n    .prohotelai-message.assistant {\n      align-self: flex-start;\n      background: rgba(15, 23, 42, 0.65);\n    }\n\n    .prohotelai-form {\n      display: flex;\n      gap: 8px;\n      padding: 12px 16px 16px 16px;\n      border-top: 1px solid rgba(148, 163, 184, 0.2);\n    }\n\n    .prohotelai-input {\n      flex: 1;\n      border: 1px solid rgba(148, 163, 184, 0.4);\n      border-radius: 12px;\n      padding: 10px 12px;\n      font-size: 14px;\n      color: var(--prohotelai-text);\n      background: rgba(15, 23, 42, 0.85);\n    }\n\n    .prohotelai-input::placeholder {\n      color: rgba(226, 232, 240, 0.6);\n    }\n\n    .prohotelai-send {\n      background: var(--prohotelai-accent);\n      color: #fff;\n      border: none;\n      border-radius: 12px;\n      padding: 0 16px;\n      font-size: 14px;\n      cursor: pointer;\n      transition: transform 0.1s ease;\n    }\n\n    .prohotelai-send:active {\n      transform: scale(0.97);\n    }\n\n    .prohotelai-voice {\n      margin-left: 4px;\n      background: transparent;\n      border: 1px solid rgba(148, 163, 184, 0.4);\n      color: var(--prohotelai-text);\n      border-radius: 12px;\n      padding: 0 12px;\n      cursor: pointer;\n      font-size: 13px;\n    }\n\n    .prohotelai-status {\n      font-size: 12px;\n      color: rgba(226, 232, 240, 0.6);\n      padding: 0 16px 12px 16px;\n    }\n  `\n\n  root.appendChild(style)\n}\n","import { WidgetTheme } from './types'\n\nconst DEFAULT_THEME: Required<WidgetTheme> = {\n  accentColor: '#2563eb',\n  backgroundColor: '#0f172a',\n  textColor: '#f8fafc',\n  borderRadius: '16px',\n  fontFamily: '\"Inter\", system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif',\n}\n\nexport function applyTheme(element: HTMLElement, theme?: WidgetTheme) {\n  const merged = { ...DEFAULT_THEME, ...(theme ?? {}) }\n  element.style.setProperty('--prohotelai-accent', merged.accentColor)\n  element.style.setProperty('--prohotelai-background', merged.backgroundColor)\n  element.style.setProperty('--prohotelai-text', merged.textColor)\n  element.style.setProperty('--prohotelai-radius', merged.borderRadius)\n  element.style.setProperty('--prohotelai-font-family', merged.fontFamily)\n}\n","import { WidgetEventBus } from './events'\nimport { injectStyles } from './style'\nimport { applyTheme } from './theme'\nimport { WidgetMessage, WidgetPermissions } from './types'\n\nexport type WidgetDomOptions = {\n  mountPoint: HTMLElement\n  eventBus: WidgetEventBus\n  t: (key: string) => string\n  onSend: (message: string) => void\n  onToggle: () => void\n  onStartVoice: () => void\n  onStopVoice: () => void\n  onRequestTicket: () => void\n  permissions?: WidgetPermissions\n  enableVoice: boolean\n}\n\nexport type WidgetDom = {\n  open: () => void\n  close: () => void\n  toggle: () => void\n  renderMessages: (messages: WidgetMessage[]) => void\n  setLanguage: (t: (key: string) => string) => void\n  setVoiceAvailable: (available: boolean) => void\n  destroy: () => void\n  setStatus: (status: string | null) => void\n}\n\nexport function createWidgetDom(options: WidgetDomOptions): WidgetDom {\n  const container = document.createElement('div')\n  container.className = 'prohotelai-widget'\n  applyTheme(container)\n  injectStyles(document)\n\n  const toggleButton = document.createElement('button')\n  toggleButton.className = 'prohotelai-toggle'\n  toggleButton.type = 'button'\n  toggleButton.setAttribute('aria-label', options.t('widget.aria.open'))\n  toggleButton.textContent = 'AI Assistant'\n  toggleButton.addEventListener('click', options.onToggle)\n\n  const windowEl = document.createElement('div')\n  windowEl.className = 'prohotelai-window'\n\n  const header = document.createElement('div')\n  header.className = 'prohotelai-header'\n  header.textContent = options.t('widget.title')\n\n  const messagesEl = document.createElement('div')\n  messagesEl.className = 'prohotelai-messages'\n\n  const statusEl = document.createElement('div')\n  statusEl.className = 'prohotelai-status'\n  statusEl.style.display = 'none'\n\n  const form = document.createElement('form')\n  form.className = 'prohotelai-form'\n\n  const input = document.createElement('input')\n  input.className = 'prohotelai-input'\n  input.type = 'text'\n  input.placeholder = options.t('widget.input.placeholder')\n  input.autocomplete = 'off'\n  input.setAttribute('aria-label', options.t('widget.input.placeholder'))\n\n  const sendButton = document.createElement('button')\n  sendButton.className = 'prohotelai-send'\n  sendButton.type = 'submit'\n  sendButton.textContent = options.t('widget.send')\n\n  const voiceButton = document.createElement('button')\n  voiceButton.className = 'prohotelai-voice'\n  voiceButton.type = 'button'\n  voiceButton.textContent = options.t('widget.voice.start')\n  voiceButton.style.display = options.enableVoice ? 'inline-flex' : 'none'\n\n  let voiceActive = false\n\n  voiceButton.addEventListener('click', () => {\n    if (!voiceActive) {\n      options.onStartVoice()\n      voiceActive = true\n      voiceButton.textContent = options.t('widget.voice.stop')\n    } else {\n      options.onStopVoice()\n      voiceActive = false\n      voiceButton.textContent = options.t('widget.voice.start')\n    }\n  })\n\n  form.addEventListener('submit', (event) => {\n    event.preventDefault()\n    const value = input.value.trim()\n    if (value.length === 0) return\n    options.onSend(value)\n    input.value = ''\n    voiceActive = false\n    voiceButton.textContent = options.t('widget.voice.start')\n  })\n\n  const ticketButton = document.createElement('button')\n  ticketButton.type = 'button'\n  ticketButton.textContent = 'Create ticket'\n  ticketButton.className = 'prohotelai-voice'\n  ticketButton.style.display = options.permissions?.includes('tickets:create') ? 'inline-flex' : 'none'\n  ticketButton.addEventListener('click', () => {\n    options.onRequestTicket()\n  })\n\n  form.appendChild(input)\n  form.appendChild(sendButton)\n  form.appendChild(voiceButton)\n  form.appendChild(ticketButton)\n\n  windowEl.appendChild(header)\n  windowEl.appendChild(messagesEl)\n  windowEl.appendChild(statusEl)\n  windowEl.appendChild(form)\n\n  container.appendChild(toggleButton)\n  container.appendChild(windowEl)\n\n  options.mountPoint.appendChild(container)\n\n  function renderMessages(messages: WidgetMessage[]) {\n    messagesEl.innerHTML = ''\n    messages.forEach((message) => {\n      const bubble = document.createElement('div')\n      bubble.className = `prohotelai-message ${message.role}`\n      bubble.textContent = message.content\n      messagesEl.appendChild(bubble)\n    })\n    messagesEl.scrollTop = messagesEl.scrollHeight\n  }\n\n  function open() {\n    windowEl.classList.add('open')\n    toggleButton.setAttribute('aria-label', options.t('widget.aria.close'))\n  }\n\n  function close() {\n    windowEl.classList.remove('open')\n    toggleButton.setAttribute('aria-label', options.t('widget.aria.open'))\n  }\n\n  function toggle() {\n    if (windowEl.classList.contains('open')) {\n      close()\n    } else {\n      open()\n    }\n  }\n\n  function setLanguage(t: (key: string) => string) {\n    header.textContent = t('widget.title')\n    input.placeholder = t('widget.input.placeholder')\n    input.setAttribute('aria-label', t('widget.input.placeholder'))\n    sendButton.textContent = t('widget.send')\n    voiceButton.textContent = voiceActive ? t('widget.voice.stop') : t('widget.voice.start')\n    toggleButton.setAttribute('aria-label', windowEl.classList.contains('open') ? t('widget.aria.close') : t('widget.aria.open'))\n  }\n\n  function setVoiceAvailable(available: boolean) {\n    voiceButton.style.display = available ? 'inline-flex' : 'none'\n  }\n\n  function setStatus(status: string | null) {\n    if (!status) {\n      statusEl.style.display = 'none'\n      statusEl.textContent = ''\n    } else {\n      statusEl.style.display = 'block'\n      statusEl.textContent = status\n    }\n  }\n\n  function destroy() {\n    container.remove()\n  }\n\n  return {\n    open,\n    close,\n    toggle,\n    renderMessages,\n    setLanguage,\n    setVoiceAvailable,\n    destroy,\n    setStatus,\n  }\n}\n","import { createChatClient } from './chatClient'\nimport { WidgetEventBus } from './events'\nimport { createTranslator } from './i18n'\nimport { createVoiceController } from './voice'\nimport { createWidgetDom } from './widgetDom'\nimport { normalizeLanguage, randomId, resolveElement } from './utils'\nimport { applyTheme } from './theme'\nimport {\n  WidgetConfig,\n  WidgetController,\n  WidgetEvent,\n  WidgetEventHandler,\n  WidgetLanguage,\n  WidgetMessage,\n  WidgetPermissions,\n} from './types'\n\nexport type {\n  WidgetConfig,\n  WidgetController,\n  WidgetLanguage,\n  WidgetMessage,\n  WidgetPermissions,\n  WidgetEvent,\n  WidgetEventHandler,\n}\n\nconst DEFAULT_LANGUAGE: WidgetLanguage = 'en'\n\nexport function createWidget(config: WidgetConfig): WidgetController {\n  const mountPoint = resolveElement(config.element)\n  const language = normalizeLanguage(config.defaultLanguage, DEFAULT_LANGUAGE)\n  const eventBus = new WidgetEventBus()\n  const translator = createTranslator(language, config.translations)\n  const chatClient = createChatClient({\n    apiBaseUrl: config.apiBaseUrl,\n    hotelId: config.hotelId,\n    conversationId: config.conversationId,\n    guestId: config.guestId,\n    headers: config.headers,\n    permissions: config.permissions,\n  })\n\n  const voice = createVoiceController({\n    eventBus,\n    onText: (text) => {\n      void sendMessage(text)\n    },\n  })\n\n  const dom = createWidgetDom({\n    mountPoint,\n    eventBus,\n    t: translator.t,\n    onSend: (message) => {\n      void sendMessage(message)\n    },\n    onToggle: () => {\n      dom.toggle()\n    },\n    onStartVoice: () => {\n      voice.startRecognition()\n    },\n    onStopVoice: () => {\n      voice.stopRecognition()\n    },\n    onRequestTicket: () => {\n      void sendMessage('Please create a ticket for this request.')\n    },\n    permissions: config.permissions,\n    enableVoice: Boolean(config.enableVoice),\n  })\n\n  applyTheme(mountPoint, config.theme)\n\n  let messages: WidgetMessage[] = []\n\n  async function sendMessage(content: string) {\n    const tempId = randomId('local')\n    const optimisticMessage: WidgetMessage = {\n      id: tempId,\n      role: 'user',\n      content,\n      createdAt: new Date(),\n    }\n    messages = [...messages, optimisticMessage]\n    dom.renderMessages(messages)\n    eventBus.emit('message:sent', { id: optimisticMessage.id, content: optimisticMessage.content })\n\n    try {\n      const { messages: responseMessages } = await chatClient.sendMessage(content)\n      messages = responseMessages\n      dom.renderMessages(messages)\n      const latest = responseMessages.at(-1)\n      if (latest && latest.role === 'assistant') {\n        eventBus.emit('message:received', { id: latest.id, content: latest.content })\n        if (config.enableVoice) {\n          voice.speak(latest.content)\n        }\n      }\n      dom.setStatus(null)\n    } catch (error) {\n      eventBus.emit('error', { message: 'Failed to send message', error })\n      dom.setStatus(translator.t('widget.status.offline'))\n    }\n  }\n\n  function setLanguage(next: WidgetLanguage) {\n    translator.setLanguage(next)\n    dom.setLanguage(translator.t)\n  }\n\n  function setTheme(theme: Parameters<typeof applyTheme>[1]) {\n    applyTheme(mountPoint, theme)\n  }\n\n  const controller: WidgetController = {\n    open: dom.open,\n    close: dom.close,\n    toggle: dom.toggle,\n    sendMessage,\n    setLanguage,\n    setTheme,\n    startVoice: () => {\n      if (!config.enableVoice) return\n      voice.startRecognition()\n    },\n    stopVoice: () => {\n      voice.stopRecognition()\n    },\n    destroy: () => {\n      dom.destroy()\n    },\n    on: (event, handler) => eventBus.on(event, handler),\n  }\n\n  dom.setVoiceAvailable(config.enableVoice ? voice.supportsRecognition() : false)\n\n  eventBus.emit('ready', { mountedAt: Date.now() })\n\n  return controller\n}\n\nif (typeof window !== 'undefined') {\n  ;(window as typeof window & { ProHotelAIWidget?: { createWidget: typeof createWidget } }).ProHotelAIWidget = {\n    createWidget,\n  }\n}\n"],"names":["resolveElement","target","el","found","buildEndpointUrl","base","path","normalizedBase","normalizedPath","randomId","prefix","toMessage","value","normalizeLanguage","language","fallback","normalized","createChatClient","config","sendMessage","content","endpoint","response","body","data","WidgetEventBus","event","handler","_a","set","payload","globalEvent","DEFAULT_DICTIONARY","createTranslator","overrides","currentLanguage","dictionaries","lang","values","existing","t","key","dict","setLanguage","createVoiceController","options","SpeechRecognition","recognition","supportsRecognition","startRecognition","transcript","_c","_b","stopRecognition","speak","text","utterance","injectStyles","root","style","DEFAULT_THEME","applyTheme","element","theme","merged","createWidgetDom","container","toggleButton","windowEl","header","messagesEl","statusEl","form","input","sendButton","voiceButton","voiceActive","ticketButton","renderMessages","messages","message","bubble","open","close","toggle","setVoiceAvailable","available","setStatus","status","destroy","DEFAULT_LANGUAGE","createWidget","mountPoint","eventBus","translator","chatClient","voice","dom","optimisticMessage","responseMessages","latest","error","next","setTheme","controller"],"mappings":"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"}